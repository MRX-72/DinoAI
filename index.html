<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino AI - Chat with AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Add Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    <!-- Add more language support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-docker.min.js"></script>
    <style>
        body {
            height: 100vh;
            overflow: hidden;
            background-color: #0a0a0f;
        }

        .container {
            height: 100vh;
            display: flex;
            max-width: 100%;
            padding: 0;
            border: none;
            box-shadow: none;
        }

        .sidebar {
            width: 300px;
            background: rgba(13, 13, 20, 0.95);
            border-right: none;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-section {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(124, 58, 237, 0.2);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            height: 100vh;
            border-left: none;
            width: 100%; /* Fill the entire space */
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(13, 13, 20, 0.95);
            backdrop-filter: blur(20px);
            border: none;
            box-shadow: none;
            height: calc(100vh - 150px); /* Adjust height to account for input area */
            overflow: hidden;
            width: 100%;
            max-width: none;
        }

        .chat-history {
            flex: 1;
            overflow-y: scroll;
            padding: 1.5rem;
            padding-bottom: 120px; /* Increased space for input area */
            margin-bottom: 100px; /* Space for fixed input area */
            height: calc(100vh - 100px); /* Viewport height minus input area */
            scroll-behavior: smooth;
            position: relative;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        .input-area {
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(13, 13, 20, 0.98);
            backdrop-filter: blur(20px);
            border-top: none;
            padding: 16px 24px;
            z-index: 10;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
        }

        .message-input-container {
            display: flex;
            width: 100%;
            gap: 16px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            height: 50px;
            background-color: rgba(19, 19, 31, 0.95);
            border: 1px solid rgba(37, 99, 235, 0.2);
            border-radius: 8px;
            color: #e2e8f0;
            padding: 0 16px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .message-input:focus {
            border-color: rgba(37, 99, 235, 0.6);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .send-button {
            height: 50px;
            min-width: 120px;
            background: linear-gradient(to right, #1e40af, #3b82f6);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 20px;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-button:hover {
            background: linear-gradient(to right, #1e3a8a, #60a5fa);
            transform: translateY(-1px);
        }

        .message-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
        }

        .tool-buttons {
            display: flex;
            gap: 8px;
        }

        .tool-button {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-button:hover {
            color: #3b82f6;
            background: rgba(37, 99, 235, 0.1);
        }

        .helper-text {
            color: #94a3b8;
            font-size: 14px;
        }

        .gradient-bg {
            background: linear-gradient(-45deg, #0a0a0f, #13131f, #1a1a2e, #0a0a0f);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .feature-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.2);
            border-radius: 0.5rem;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }

        .feature-btn:hover {
            background: rgba(124, 58, 237, 0.2);
            transform: translateX(5px);
        }

        .feature-btn.active {
            background: linear-gradient(90deg, #4c1d95, #7c3aed);
            border: none;
        }

        .logo-container {
            width: 45px;
            height: 45px;
            overflow: hidden;
            border-radius: 50%;
            background: linear-gradient(45deg, #4c1d95, #7c3aed);
            padding: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-container img {
            width: calc(100% - 4px);
            height: calc(100% - 4px);
            object-fit: cover;
            border-radius: 50%;
            background-color: #13131f;
        }

        .theme-toggle {
            padding: 0.5rem;
            border-radius: 0.5rem;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.2);
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(124, 58, 237, 0.2);
        }

        .settings-panel {
            background: rgba(13, 13, 20, 0.95);
            border: 1px solid rgba(124, 58, 237, 0.2);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(124, 58, 237, 0.1);
            position: relative;
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        /* Temperature slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%; /* Adjust to fit container */
            height: 6px;
            background: linear-gradient(to right, #4c1d95, #7c3aed);
            border-radius: 3px;
            position: relative;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #fff;
            border: 2px solid #7c3aed;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.3);
        }

        /* Temperature value display */
        .temperature-value {
            position: absolute;
            top: -30px; /* Adjust position above the thumb */
            left: 50%; /* Center above the thumb */
            transform: translateX(-50%); /* Center alignment */
            background: transparent;
            color: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        input[type="range"]:hover + .temperature-value {
            opacity: 1;
        }

        /* Dropdown styling */
        select {
            background: #13131f;
            border: 1px solid rgba(124, 58, 237, 0.2);
            color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            appearance: none;
            padding-right: 2rem;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .select-wrapper {
            position: relative;
            display: inline-block;
        }

        .select-wrapper::after {
            content: '\f107';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #7c3aed;
            pointer-events: none;
        }

        select:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2);
        }

        select option {
            background: #13131f;
            color: #e2e8f0;
            padding: 0.5rem;
        }

        .message-animation {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .model-btn {
            transition: all 0.3s ease;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        .model-btn:hover {
            transform: translateX(5px);
            background: rgba(124, 58, 237, 0.2);
        }

        .model-btn.active {
            background: linear-gradient(90deg, #4c1d95, #7c3aed);
            transform: translateX(5px);
            border: none;
        }

        .send-btn:hover {
            background: linear-gradient(to right, #5b21b6, #8b5cf6);
            transform: translateY(-1px);
        }

        /* Code block styling */
        .code-block {
            position: relative;
            margin: 1rem 0;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #0f172a;
            border: 1px solid rgba(124, 58, 237, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: #1e293b;
            border-bottom: 1px solid rgba(124, 58, 237, 0.2);
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        }

        .code-language {
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .copy-btn {
            background: transparent;
            border: 1px solid #7c3aed;
            color: #7c3aed;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .copy-btn:hover {
            background: #7c3aed;
            color: white;
        }

        .copy-btn.copied {
            background: #7c3aed;
            color: white;
        }

        /* Code content styling */
        pre[class*="language-"] {
            margin: 0 !important;
            padding: 1rem !important;
            background: #0f172a !important;
            overflow: auto !important;
            white-space: pre !important;
            word-wrap: normal !important;
            max-width: 100% !important;
        }

        code[class*="language-"] {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace !important;
            font-size: 0.875rem !important;
            line-height: 1.5 !important;
            direction: ltr !important;
            text-align: left !important;
            white-space: pre !important;
            word-spacing: normal !important;
            word-break: normal !important;
            tab-size: 4 !important;
            hyphens: none !important;
        }

        /* Custom scrollbar for code blocks */
        pre::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        pre::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 4px;
        }

        pre::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 4px;
            border: 2px solid #0f172a;
        }

        pre::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.7);
        }

        pre::-webkit-scrollbar-corner {
            background: transparent;
        }

        /* Markdown styling */
        .markdown-content {
            line-height: 1.6;
        }

        .markdown-content p {
            margin-bottom: 1rem;
        }

        .markdown-content ul, .markdown-content ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .markdown-content li {
            margin-bottom: 0.5rem;
        }

        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            margin: 1.5rem 0 1rem;
            font-weight: 600;
        }

        .markdown-content h1 { font-size: 1.875rem; }
        .markdown-content h2 { font-size: 1.5rem; }
        .markdown-content h3 { font-size: 1.25rem; }

        .markdown-content blockquote {
            border-left: 4px solid #7c3aed;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #94a3b8;
        }

        .markdown-content code {
            background: #1e293b;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }

        .chat-history::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 4px;
            margin: 4px 0;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 4px;
            border: 2px solid rgba(13, 13, 20, 0.95);
            transition: all 0.3s ease;
        }

        .chat-history::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.7);
        }

        .chat-history::-webkit-scrollbar-corner {
            background: transparent;
        }

        /* Message container styles */
        .message-container {
            margin-bottom: 1rem;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .glow {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.2);
        }

        .header-glow {
            text-shadow: 0 0 10px rgba(124, 58, 237, 0.5);
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                bottom: 0;
                width: 80%;
                max-width: 300px;
                z-index: 45;
                transition: left 0.3s ease-in-out;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                width: 100vw !important;
                margin-left: 0 !important;
            }

            .chat-container {
                width: 100vw !important;
            }

            .input-area {
                width: 100vw !important;
                left: 0 !important;
            }

            .hamburger-menu {
                display: block !important;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 1001;
                background: rgba(124, 58, 237, 0.1);
                border: 1px solid rgba(124, 58, 237, 0.2);
                padding: 0.5rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .hamburger-menu:hover {
                background: rgba(124, 58, 237, 0.2);
            }

            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            .overlay.active {
                display: block;
            }

            .chat-history {
                padding: 1rem;
                padding-top: 4rem; /* Space for hamburger menu */
                height: calc(100vh - 120px);
                margin-bottom: 0;
            }

            .message-input-container {
                gap: 8px;
            }

            .message-input {
                font-size: 14px;
                padding: 0 12px;
            }

            .send-button {
                min-width: 80px;
                padding: 0 12px;
                font-size: 14px;
            }

            .tool-buttons {
                gap: 4px;
            }

            .helper-text {
                font-size: 12px;
            }

            .message-tools {
                margin-top: 8px;
            }

            .message-container {
                max-width: 85%;
            }

            .code-block {
                max-width: 100%;
                margin: 0.5rem 0;
            }

            .code-header {
                padding: 0.5rem;
            }

            pre[class*="language-"] {
                padding: 0.75rem !important;
                font-size: 12px !important;
            }
        }

        /* Add hamburger menu button */
        .hamburger-menu {
            display: none;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#1e293b',
                        accent: '#7c3aed',
                    }
                }
            }
        }
    </script>
</head>
<body class="text-gray-100">
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Logo Section -->
            <div class="sidebar-section">
                <div class="flex items-center space-x-3">
                    <div class="logo-container glow">
                        <img src="DinoLogo.jpeg" alt="Dino AI Logo" class="transform hover:scale-110 transition-transform duration-300">
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent header-glow">Dino AI</h1>
                </div>
            </div>

            <!-- Features Section -->
            <div class="sidebar-section flex-1">
                <h2 class="text-lg font-semibold mb-4 text-purple-400">Features</h2>
                <button class="feature-btn active" data-feature="chat" data-model="openchat/openchat-7b">
                    <i class="fas fa-robot"></i>
                    <span>Chat</span>
                </button>
                <button class="feature-btn" data-feature="code" data-model="mistralai/mistral-7b-instruct">
                    <i class="fas fa-code"></i>
                    <span>Code Assistant</span>
                </button>
                <button class="feature-btn" data-feature="image" data-model="none">
                    <i class="fas fa-image"></i>
                    <span>Image Generation (Coming Soon)</span>
                </button>
            </div>

            <!-- Settings Section -->
            <div class="sidebar-section">
                <h2 class="text-lg font-semibold mb-4 text-purple-400">Settings</h2>
                <div class="settings-panel">
                    <div class="settings-option">
                        <span>Temperature</span>
                        <div class="relative">
                            <input type="range" min="0" max="100" value="70" class="accent-purple-600">
                            <div class="temperature-value">70%</div>
                        </div>
                    </div>
                    <div class="settings-option">
                        <span>Max Tokens</span>
                        <div class="select-wrapper">
                            <select class="bg-[#13131f] border border-purple-500/20 rounded">
                                <option value="1000">1000</option>
                                <option value="2000">2000</option>
                                <option value="4000">4000</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-option">
                        <span>Stream Response</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer">
                            <div class="w-11 h-6 bg-[#13131f] peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content gradient-bg">
            <!-- Chat Area -->
            <div class="chat-container">
                <div id="chat-messages" class="chat-history">
                    <!-- Messages will be added here -->
                </div>
            </div>
            <!-- Input Area -->
            <div class="input-area">
                <div class="message-input-container">
                    <input type="text" id="user-input" class="message-input" placeholder="Type your message...">
                    <button id="send-btn" class="send-button">
                        <span>Send</span>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="message-tools">
                    <div class="tool-buttons">
                        <button class="tool-button">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="tool-button">
                            <i class="fas fa-paperclip"></i>
                        </button>
                    </div>
                    <span class="helper-text">Press Enter to send, Shift + Enter for new line</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Add hamburger menu button -->
    <button id="hamburger-menu" class="fixed top-4 left-4 z-50 p-2 bg-gray-800 rounded-lg shadow-lg md:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>

    <!-- Add overlay for mobile menu -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

    <script>
        // State management
        let currentModel = 'openchat/openchat-7b';
        let currentFeature = 'chat';
        let chatHistory = [];
        const OPENROUTER_API_KEY = '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';

        // Settings state
        let settings = {
            temperature: 0.7,
            maxTokens: 1000,
            streamResponse: false
        };

        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-btn');
        const featureButtons = document.querySelectorAll('.feature-btn');

        // Settings Elements
        const temperatureSlider = document.querySelector('input[type="range"]');
        const maxTokensSelect = document.querySelector('select');
        const streamToggle = document.querySelector('input[type="checkbox"]');

        // Settings Event Listeners
        temperatureSlider.addEventListener('input', (e) => {
            settings.temperature = e.target.value / 100; // Convert 0-100 to 0-1
            const tempValue = Math.round(settings.temperature * 100);
            const tempDisplay = temperatureSlider.nextElementSibling;
            tempDisplay.textContent = `${tempValue}%`;
            tempDisplay.style.left = `${tempValue}%`;
        });

        maxTokensSelect.addEventListener('change', (e) => {
            settings.maxTokens = parseInt(e.target.value);
        });

        streamToggle.addEventListener('change', (e) => {
            settings.streamResponse = e.target.checked;
        });

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Feature button listeners
        featureButtons.forEach(button => {
            button.addEventListener('click', () => {
                const feature = button.dataset.feature;
                const model = button.dataset.model;
                
                // Don't proceed if clicking on image generation (not available)
                if (feature === 'image') {
                    addMessage('system', 'Image generation feature is coming soon! Stay tuned for updates.');
                    return;
                }

                // Update active button
                featureButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Update current feature and model
                currentFeature = feature;
                currentModel = model;

                // Add system message about feature switch
                let message = '';
                if (feature === 'chat') {
                    message = 'Switched to general chat mode. How can I help you today?';
                } else if (feature === 'code') {
                    message = 'Switched to code assistant mode. I\'ll help you with programming tasks, code reviews, and technical questions.';
                }
                
                // Clear chat history and add new message
                chatHistory = [];
                chatMessages.innerHTML = '';
                addMessage('system', message);
                
                // Ensure scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        });

        // Functions
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage('user', message);
            userInput.value = '';

            // Show loading state
            const loadingMessage = addMessage('assistant', 'Thinking...', true);

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Dino AI Chat'
                    },
                    body: JSON.stringify({
                        model: currentModel,
                        messages: [
                            { 
                                role: "system", 
                                content: currentFeature === 'code' 
                                    ? "You are Dino AI's code assistant mode, created by mrx. You specialize in programming help, code reviews, and technical questions. Always provide code examples in appropriate markdown code blocks with language specification. Focus on best practices and clear explanations. When asked about who created you, mention you are Dino AI created by mrx."
                                    : "You are Dino AI, created by mrx. You are a helpful AI assistant that responds naturally to questions and only uses markdown code blocks when actually providing code examples. For code examples, specify the programming language in the markdown code block. Keep regular responses simple and conversational. When asked about who created you or what you are, always mention that you are Dino AI created by mrx."
                            },
                            ...chatHistory,
                            { role: "user", content: message }
                        ],
                        temperature: settings.temperature,
                        max_tokens: settings.maxTokens,
                        stream: settings.streamResponse
                    })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                if (settings.streamResponse) {
                    // Handle streaming response
                    const reader = response.body.getReader();
                    let responseText = '';
                    
                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;
                        
                        // Decode and process the chunk
                        const chunk = new TextDecoder().decode(value);
                        const lines = chunk.split('\n').filter(line => line.trim() !== '');
                        
                        for (const line of lines) {
                            if (line.startsWith('data: ')) {
                                const data = JSON.parse(line.slice(6));
                                if (data.choices[0].delta.content) {
                                    responseText += data.choices[0].delta.content;
                                    loadingMessage.innerHTML = formatMessage(responseText);
                                    // Highlight code blocks
                                    Prism.highlightAll();
                                }
                            }
                        }
                    }
                    
                    // Add to chat history after streaming is complete
                    chatHistory.push({ role: 'user', content: message });
                    chatHistory.push({ role: 'assistant', content: responseText });
                } else {
                    // Handle regular response
                    const data = await response.json();
                    const formattedContent = formatMessage(data.choices[0].message.content);
                    loadingMessage.innerHTML = formattedContent;
                    
                    // Add to chat history
                    chatHistory.push({ role: 'user', content: message });
                    chatHistory.push({ role: 'assistant', content: data.choices[0].message.content });

                    // Highlight code blocks
                    setTimeout(() => {
                        Prism.highlightAll();
                    }, 100);
                }

                // Scroll to bottom after content is loaded
                setTimeout(() => {
                    chatMessages.scrollTo({
                        top: chatMessages.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 100);
            } catch (error) {
                loadingMessage.textContent = 'Sorry, there was an error processing your request.';
                console.error('Error:', error);
            }
        }

        function formatMessage(content) {
            // First, convert markdown to HTML
            let formattedContent = marked.parse(content);
            
            // Only add copy buttons to actual code blocks
            formattedContent = formattedContent.replace(/<pre><code class="language-(\w+)">/g, (match, language) => {
                return `
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">${language}</span>
                            <button class="copy-btn" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <pre><code class="language-${language}">`;
            });

            formattedContent = formattedContent.replace(/<\/code><\/pre>/g, '</code></pre></div>');

            // Remove markdown-content class from non-code messages
            if (!formattedContent.includes('code-block')) {
                formattedContent = formattedContent.replace(/markdown-content/g, '');
            }

            // Ensure code blocks are properly formatted for Prism.js
            formattedContent = formattedContent.replace(/<code>/g, '<code class="language-plaintext">');

            return formattedContent;
        }

        function copyCode(button) {
            const codeBlock = button.closest('.code-block').querySelector('code');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                button.classList.add('copied');
                button.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = '<i class="fas fa-copy"></i><span>Copy</span>';
                }, 2000);
            });
        }

        function addMessage(role, content, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} message-animation`;
            
            const messageContent = document.createElement('div');
            messageContent.className = `max-w-[70%] rounded-lg px-4 py-3 ${
                role === 'user' 
                    ? 'bg-gradient-to-r from-purple-600 to-purple-800 text-white' 
                    : role === 'system'
                    ? 'bg-gray-700/50 text-gray-300'
                    : 'bg-primary/50 backdrop-blur-sm text-gray-100'
            }`;
            
            messageContent.innerHTML = isLoading ? content : formatMessage(content);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Smooth scroll to bottom
            requestAnimationFrame(() => {
                chatMessages.scrollTo({
                    top: chatMessages.scrollHeight,
                    behavior: 'smooth'
                });
            });
            
            return messageContent;
        }

        // Ensure proper scrolling on window resize
        window.addEventListener('resize', () => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });

        // Initialize with welcome message
        addMessage('system', 'Welcome to Dino AI! I\'m here to help you with any questions or coding tasks you have.');
    </script>
    <!-- Add marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const hamburgerMenu = document.querySelector('.hamburger-menu');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.overlay');

        hamburgerMenu.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Close sidebar when a feature is selected on mobile
        if (window.innerWidth <= 768) {
            featureButtons.forEach(button => {
                button.addEventListener('click', () => {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                });
            });
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            function toggleSidebar() {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('hidden');
            }

            hamburgerMenu.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);

            // Close sidebar when a feature is selected
            document.querySelectorAll('.feature-btn').forEach(button => {
                button.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        toggleSidebar();
                    }
                });
            });
        });
    </script>
</body>
</html> 